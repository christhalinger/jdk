language: java

jobs:
  include:
    - os: linux
      dist: xenial
    - os: osx
      osx_image: xcode11.1

addons:
  apt:
    packages:
      - libasound2-dev
      - libcups2-dev
      - libx11-dev
      - libxext-dev
      - libxrandr-dev
      - libxrender-dev
      - libxt-dev
      - libxtst-dev

jdk:
    - openjdk13

notifications:
  email:
    recipients:
      - cthalinger@twitter.com
    on_success: never
    on_failure: always

install:
  - wget https://ci.adoptopenjdk.net/view/Dependencies/job/jtreg/lastSuccessfulBuild/artifact/jtreg-5.0-b01.tar.gz -O $TRAVIS_BUILD_DIR/jtreg.tar.gz
  - tar -xvf $TRAVIS_BUILD_DIR/jtreg.tar.gz -C $TRAVIS_BUILD_DIR
  - export JT_HOME=$TRAVIS_BUILD_DIR/jtreg

before_script:
  - |
      # Print some machine info.
      case $TRAVIS_OS_NAME in
        linux)
          lshw -C CPU
          free -h
          df -h
          ;;
        osx)
          sysctl -h hw.ncpu
          sysctl -h hw.memsize
          df -h
          ;;
      esac

script:
  - sh configure
  - make images LOG=info
  - make test-image LOG=info
  - make run-test-jdk_lang TEST_JOBS=4
